webpackJsonp([5],{280:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(312),l=a(345),n=a(0),o=n(r.a,l.a,!1,null,null,null);t.default=o.exports},312:function(e,t,a){"use strict";var r,l=a(342),n=a.n(l),o=a(174),i=a.n(o),s=a(26),c=a.n(s),u=a(12),d=a.n(u),f=a(13),p=a.n(f),m=a(1),b=a(33),_=a(7),h=a(178),v=(a(5),a(36)),k={columns:[{name:"payment_type",label:Object(m.d)("fukuanleixing"),type:"select",source:"paymenttype"},{name:"currency",label:Object(m.d)("bizhong"),type:"select",source:"currency"},{name:"amount",label:Object(m.d)("jine")},{name:"paymentdate",label:Object(m.d)("fukuanriqi"),type:"date"},{name:"memo",label:Object(m.d)("beizhu")},{name:"makestaff",label:Object(m.d)("tijiaoren"),type:"select",source:"user",is_edit_hide:!0},{name:"status",label:Object(m.d)("yiruzhang"),type:"switch",is_edit_hide:!0}],controller:"salesreceive",auth:"sales",base:{salesid:""},options:{isedit:function(e){return 0==e.status},isdelete:function(e){return 0==e.status}}},y=function(e){var t={loadPrice:function(){var t=this;return p()(d.a.mark(function a(){var r,l,n;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(""!=e.form.priceid){t.next=2;break}return t.abrupt("return");case 2:if(r=e.computeProductPrice,l=[],e.tabledata.forEach(function(t){var a=t.productstock.productid;void 0===r[a]&&(e.productPrices.push({productid:a,priceid:e.form.priceid,price:""}),l.push(a))}),!(l.length>0)){t.next=10;break}return t.next=8,v.a.getPriceByProductIds("",l.join(","));case 8:n=t.sent,n.forEach(function(t){e.productPrices.forEach(function(e){t.productid==e.productid&&t.id==e.priceid&&(e.price=t.price)})});case 10:case"end":return t.stop()}},a,t)}))()},onSelect:function(a){e.tabledata.find(function(e){return e.productstock.id===a.id})||(e.tabledata.push({productstock:a,number:1,is_match:!0,dealprice:0,price:0}),t.loadPrice())}};return t};t.a={name:"sp-salesdetail",components:{search:h.a},props:{visible:{type:Boolean},data:{type:Object}},data:function(){return{form:{memberid:"",salesstaff:"",externalno:"",warehouseid:"",salesdate:"",ordercode:"",pickingtype:"",expresspaidtype:"",expressno:"",expressfee:"",address:"",saleportid:"",status:0,priceid:"",makestaff:"",makedate:"",id:""},tabledata:[],base:{warehouseid:""},props:k,pricename:"",productPrices:[]}},methods:(r={onPriceChange:function(e,t){this.pricename=t,y(this).loadPrice()},addReceive:function(){var e=this;e.form.id>0&&(k.base.salesid=e.form.id,e.$refs.receive.showFormToCreate())},getDealPrice:function(e){return 0==e.is_match?e.dealprice:e.price*e.number*this.form.discount},onWarehouseChange:function(e){this.base.warehouseid=e},showProduct:function(){this.$refs.stocksearch.setVisible(!0)},onSelect:function(e){y(this).onSelect(e)},saveOrder:function(e){var t=this;if(2!=t.form.status){t.form.status=e;var a={form:t.form};a.list=t.tabledata.map(function(e){return{productstockid:e.productstock.id,id:e.id,dealprice:e.dealprice,number:e.number,price:t.computeProductPrice[e.productstock.productid],priceid:t.form.priceid}}),t._log(c()(a)),t._submit("/sales/savesale",{params:c()(a)}).then(function(e){var a=e.data;a.form.id&&(m.f.copyTo(a.form,t.form),k.base.salesid=t.form.id,t.tabledata=[],a.list.forEach(function(e){t._log(e),t.appendRow(e)})),t.$emit("change",e.data.form)})}},deleteRow:function(e,t){var a=this;a.$delete(a.tabledata,e)},showAttachment:function(){var e=this;e.form.id>0&&e.form.status},zuofei:function(){var e=this;e.canZuofei&&e.$confirm(e._label("zuofei_warning"),e._label("tip"),{confirmButtonText:e._label("ok"),cancelButtonText:e._label("cancel"),type:"warning"}).then(function(){e.saveOrder(2)})},yushou:function(){this.canYushou&&this.saveOrder(0)},tijiao:function(){var e=this;e.canTijiao&&e.$confirm(e._label("tijiao_warning"),e._label("tip"),{confirmButtonText:e._label("ok"),cancelButtonText:e._label("cancel"),type:"warning"}).then(function(){e.saveOrder(1)})}},i()(r,"deleteRow",function(e,t){var a=this;a.$delete(a.tabledata,e)}),i()(r,"appendRow",function(e){var t=this;b.f.get(e.productstock,function(a){t._log("Productstock",a),e.productstock=a,e.is_match=1==parseInt(e.is_match),t.tabledata.push(e)},1)}),r),computed:{isEditable:function(){var e=this.form.status;return 0==e||""==e||!e},canZuofei:function(){return this.form.id>0&&0==this.form.status},canTijiao:function(){var e=this.form;return""==e.id||2!=e.status},canYushou:function(){var e=this.form;return""==e.id||0==e.status},computeProductPrice:function(){var e=this,t=n()(null);return e.productPrices.forEach(function(a){a.priceid==e.form.priceid&&(t[a.productid]=a.price)}),t}},mounted:function(){var e=this,t=e.$route,a=void 0;0==t.params.id?a=e._label("xinjianxiaoshoudan"):(e.tabledata=[],e._fetch("/sales/loadsale",{id:t.params.id}).then(function(t){Object(_.a)(t.data.form,e.form),t.data.list&&t.data.list.forEach(function(t){e.appendRow(t)}),e._setTitle(e._label("xiaoshoudan")+e.form.id)}),a="loading..."),e._setTitle(a)}}},342:function(e,t,a){e.exports={default:a(343),__esModule:!0}},343:function(e,t,a){a(344);var r=a(2).Object;e.exports=function(e,t){return r.create(e,t)}},344:function(e,t,a){var r=a(9);r(r.S,"Object",{create:a(55)})},345:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{staticClass:"order-form",staticStyle:{width:"100%"},attrs:{model:e.form,"label-width":"85px",inline:!0,size:"mini"}},[a("el-row",{attrs:{gutter:0}},[a("au-button",{attrs:{auth:"sales",type:e.canYushou?"primary":"info"},on:{click:function(t){return e.yushou()}}},[e._v(e._s(e._label("yushou")))]),e._v(" "),a("au-button",{attrs:{auth:"sales",type:e.canTijiao?"primary":"info"},on:{click:function(t){return e.tijiao()}}},[e._v(e._s(e._label("tijiao")))]),e._v(" "),a("au-button",{attrs:{auth:"sales",type:e.form.id>0&&2!=e.form.status?"primary":"info"},on:{click:function(t){return e.showAttachment()}}},[e._v(e._s(e._label("fujian")))]),e._v(" "),a("au-button",{attrs:{auth:"sales",type:e.canZuofei?"primary":"info"},on:{click:function(t){return e.zuofei()}}},[e._v(e._s(e._label("zuofei")))]),e._v(" "),a("au-button",{attrs:{auth:"sales",type:e.form.id>0?"primary":"info"},on:{click:e.addReceive}},[e._v(e._s(e._label("tianjiashoukuan")))]),e._v(" "),a("as-button",{attrs:{type:"primary"},on:{click:function(t){return e.showProduct()}}},[e._v(e._s(e._label("xuanzeshangpin")))])],1),e._v(" "),a("el-row",{attrs:{gutter:0}},[a("el-col",{staticStyle:{width:"300px"},attrs:{span:4}},[a("el-form-item",{attrs:{label:e._label("xiaoshouduankou")}},[a("simple-select",{ref:"saleportid",attrs:{source:"usersaleport"},model:{value:e.form.saleportid,callback:function(t){e.$set(e.form,"saleportid",t)},expression:"form.saleportid"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("jiage")}},[a("simple-select",{ref:"priceid",attrs:{source:"userprice"},on:{change:e.onPriceChange},model:{value:e.form.priceid,callback:function(t){e.$set(e.form,"priceid",t)},expression:"form.priceid"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("xiaoshoucangku")}},[a("simple-select",{attrs:{source:"userwarehouse",disabled:0!=e.form.status},on:{change:e.onWarehouseChange},model:{value:e.form.warehouseid,callback:function(t){e.$set(e.form,"warehouseid",t)},expression:"form.warehouseid"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("xiaoshouriqi")}},[a("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd"},model:{value:e.form.salesdate,callback:function(t){e.$set(e.form,"salesdate",t)},expression:"form.salesdate"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("huiyuan")}},[a("simple-select",{attrs:{source:"member"},model:{value:e.form.memberid,callback:function(t){e.$set(e.form,"memberid",t)},expression:"form.memberid"}})],1)],1),e._v(" "),a("el-col",{staticStyle:{width:"300px"},attrs:{span:4}},[a("el-form-item",{attrs:{label:e._label("xiaoshouren")}},[a("simple-select",{attrs:{source:"user"},model:{value:e.form.salesstaff,callback:function(t){e.$set(e.form,"salesstaff",t)},expression:"form.salesstaff"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("waitudingdanhao")}},[a("el-input",{model:{value:e.form.externalno,callback:function(t){e.$set(e.form,"externalno",t)},expression:"form.externalno"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("duizhangdanhao")}},[a("el-input",{model:{value:e.form.ordercode,callback:function(t){e.$set(e.form,"ordercode",t)},expression:"form.ordercode"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("zhidanriqi")}},[a("el-input",{attrs:{value:e.form.makedate,placeholder:e._label("zidonghuoqu"),disabled:""}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("zhidanren")}},[a("sp-display-input",{attrs:{value:e.form.makestaff,source:"user"}})],1)],1),e._v(" "),a("el-col",{staticStyle:{width:"300px"},attrs:{span:4}},[a("el-form-item",{attrs:{label:e._label("tihuofangshi")}},[a("simple-select",{attrs:{source:"pickingtype"},model:{value:e.form.pickingtype,callback:function(t){e.$set(e.form,"pickingtype",t)},expression:"form.pickingtype"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("kuaidifukuanfang")}},[a("simple-select",{attrs:{source:"expresspaidtype"},model:{value:e.form.expresspaidtype,callback:function(t){e.$set(e.form,"expresspaidtype",t)},expression:"form.expresspaidtype"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("kuaididanhao")}},[a("el-input",{model:{value:e.form.expressno,callback:function(t){e.$set(e.form,"expressno",t)},expression:"form.expressno"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("kuaidifeiyong")}},[a("el-input",{model:{value:e.form.expressfee,callback:function(t){e.$set(e.form,"expressfee",t)},expression:"form.expressfee"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("shouhuodizhi")}},[a("el-input",{model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}})],1)],1)],1)],1),e._v(" "),0==e.form.status?a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:24}},[a("search",{attrs:{base:e.base},on:{select:e.onSelect}})],1)],1):e._e(),e._v(" "),a("el-row",[a("el-col",{attrs:{span:24}},[0==e.form.status?a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tabledata,stripe:"",border:""}},[a("el-table-column",{attrs:{label:e._label("guojima"),align:"left",width:"200"},scopedSlots:e._u([{key:"default",fn:function(e){var t=e.row;return[a("sp-product-tip",{attrs:{product:t.productstock.product}})]}}],null,!1,3240663051)}),e._v(" "),a("el-table-column",{attrs:{label:e._label("chima"),width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){var t=e.row;return[a("sp-select-text",{attrs:{value:t.productstock.sizecontentid,source:"sizecontent"}})]}}],null,!1,35572469)}),e._v(" "),a("el-table-column",{attrs:{label:e._label("cangku"),width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v("\n                        "+e._s(a.productstock.warehouse.name)+"\n                    ")]}}],null,!1,1865918262)}),e._v(" "),a("el-table-column",{attrs:{label:e._label("kucunshuliang"),width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v("\n                        "+e._s(a.productstock.number)+"\n                    ")]}}],null,!1,2015397657)}),e._v(" "),a("el-table-column",{attrs:{label:e.pricename,width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v("\n                        "+e._s(e.computeProductPrice[a.productstock.productid])+"\n                    ")]}}],null,!1,3166828521)}),e._v(" "),a("el-table-column",{attrs:{label:e._label("zongjia"),width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v("\n                        "+e._s(a.dealprice*a.number)+"\n                    ")]}}],null,!1,3239432915)}),e._v(" "),a("el-table-column",{attrs:{label:e._label("shuliang"),width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-input-number",{attrs:{min:1,max:r.productstock.getAvailableNumber(),size:"mini"},model:{value:r.number,callback:function(t){e.$set(r,"number",t)},expression:"row.number"}})]}}],null,!1,2392639529)}),e._v(" "),a("el-table-column",{attrs:{label:e._label("chengjiaojia"),width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-input",{attrs:{size:"mini"},model:{value:r.dealprice,callback:function(t){e.$set(r,"dealprice",t)},expression:"row.dealprice"}})]}}],null,!1,1708516934)}),e._v(" "),a("el-table-column",{attrs:{label:e._label("caozuo"),width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row,l=t.$index;return[a("as-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.deleteRow(l,r)}}},[e._v(e._s(e._label("shanchu")))])]}}],null,!1,3428101906)})],1):e._e(),e._v(" "),0!=e.form.status?a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tabledata,stripe:"",border:""}},[a("el-table-column",{attrs:{prop:"productname",label:e._label("chanpinmingcheng"),align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"sizecontent_label",label:e._label("chima"),width:"100",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"warehousename",label:e._label("cangku"),width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(t.row.productstock.warehouse.name)+"\n                    ")]}}],null,!1,2274592980)}),e._v(" "),a("el-table-column",{attrs:{prop:"price",label:e._label("danjia"),width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(t.row.price)+"\n                    ")]}}],null,!1,4189293232)}),e._v(" "),a("el-table-column",{attrs:{prop:"number",label:e._label("xiaoshoushuliang"),width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(t.row.number)+"\n                    ")]}}],null,!1,952877758)}),e._v(" "),a("el-table-column",{attrs:{prop:"discount",label:e._label("zongjia"),width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(e.form.discount*t.row.price*t.row.number)+"\n                    ")]}}],null,!1,4156685078)}),e._v(" "),a("el-table-column",{attrs:{prop:"dealprice",label:e._label("chengjiaozongjia"),width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(e.getDealPrice(t.row))+"\n                    ")]}}],null,!1,3664245285)})],1):e._e()],1)],1),e._v(" "),a("sp-productstock-search",{ref:"stocksearch",on:{select:e.onSelect}})],1)},l=[],n={render:r,staticRenderFns:l};t.a=n}});
//# sourceMappingURL=5-1010.js.map