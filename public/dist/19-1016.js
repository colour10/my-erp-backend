webpackJsonp([19],{294:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(329),r=n(369),a=n(0),i=a(o.a,r.a,!1,null,null,null);t.default=i.exports},329:function(e,t,n){"use strict";var o=n(27),r=n.n(o),a=n(9),i=n.n(a),l=n(10),c=n.n(l),u=n(7),s=n(35);t.a={name:"sp-requisitioncreate",data:function(){return{form:{out_id:"",in_id:"",memo:""},index:1,tabledata:[],productstocks:[]}},methods:{onOutChange:function(){var e=this;e.form.out_id>0&&e.tabledata.forEach(function(t){t.out_id=e.form.out_id});var t=e.tabledata.pop();t&&e.tabledata.push(t)},onInChange:function(){var e=this;e.form.in_id>0&&e.tabledata.forEach(function(t){t.in_id=e.form.in_id})},onWarehouseChange:function(e,t){var n=this,o=t.product,r=t.sizecontentid;return c()(i.a.mark(function e(){var t,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n,e.next=3,s.a.getProductstock({productid:o.id,sizecontentid:r});case 3:a=e.sent;case 4:case"end":return e.stop()}},e,n)}))()},onSelect:function(e){var t=this,n=e.product,o=e.number,r=e.sizecontentid;return c()(i.a.mark(function e(){var a,l;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t,e.next=3,s.a.getProductstock({productid:n.id,sizecontentid:r});case 3:l=e.sent,l.forEach(function(e){a.productstocks.push(e)}),a.tabledata.push({index:a.index,product:n,number:o,sizecontentid:r,property:1,defective_level:1,stock_number:"",in_id:a.form.in_id,out_id:a.form.out_id}),a.index+=1;case 7:case"end":return e.stop()}},e,t)}))()},saveOrder:function(){var e=this;if(confirm(e._label("order_submit_confirm"))){var t={memo:e.form.memo};t.list=e.tabledata.map(function(e){var t=e.product,n=e.sizecontentid,o=e.out_id,r=e.in_id,a=e.property,i=e.defective_level,l=e.number;return{productid:t.id,sizecontentid:n,out_id:o,in_id:r,property:a,defective_level:i,number:l}}),e._submit("/requisition/save",{params:r()(t)}).then(function(t){Object(u.b)(e.form,{out_id:"",in_id:"",memo:""}),e.tabledata=[],e.productstocks=[]})}},deleteRow:function(e){var t=e.$index;this.tabledata.splice(t,1)}},mounted:function(){var e=this;e._setTitle(e._label("xinjiandiaobodan"))},computed:{stockStat:function(){var e=this,t={};return e.productstocks.forEach(function(e){var n=[e.productid,e.sizecontentid,e.property,e.defective_level,e.warehouseid].join("-");t[n]=e.number-e.reserve_number}),t},stocks:function(){var e=this,t={},n=e.stockStat;return e.tabledata.forEach(function(e){var o=[e.product.id,e.sizecontentid,e.property,e.defective_level,e.out_id].join("-");t[e.index]=n[o]||0}),t},filterMethods:function(){var e=this,t={},n=e.stockStat;return e.tabledata.forEach(function(o){t[o.index]=function(t,r){var a=[o.product.id,o.sizecontentid,o.property,o.defective_level,r.id].join("-");return e.form.out_id==r.id||o.out_id==r.id||n[a]&&n[a]>0}}),t}}}},369:function(e,t,n){"use strict";var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-form",{staticClass:"order-form",staticStyle:{width:"100%"},attrs:{model:e.form,"label-width":"85px",inline:!0,size:"mini"}},[n("el-row",{attrs:{gutter:0}},[n("as-button",{attrs:{type:"primary"},on:{click:e.saveOrder}},[e._v(e._s(e._label("shenqing")))])],1),e._v(" "),n("el-row",{attrs:{gutter:0}},[n("el-col",{staticStyle:{width:"300px"},attrs:{span:6}},[n("el-form-item",{attrs:{label:e._label("diaochucangku")}},[n("simple-select",{attrs:{source:"warehouse"},on:{change:e.onOutChange},model:{value:e.form.out_id,callback:function(t){e.$set(e.form,"out_id",t)},expression:"form.out_id"}})],1)],1),e._v(" "),n("el-col",{staticStyle:{width:"300px"},attrs:{span:6}},[n("el-form-item",{attrs:{label:e._label("diaorucangku")}},[n("simple-select",{attrs:{source:"warehouse"},on:{change:e.onInChange},model:{value:e.form.in_id,callback:function(t){e.$set(e.form,"in_id",t)},expression:"form.in_id"}})],1)],1),e._v(" "),n("el-col",{staticStyle:{width:"300px"},attrs:{span:6}},[n("el-form-item",{attrs:{label:e._label("beizhu")}},[n("el-input",{model:{value:e.form.memo,callback:function(t){e.$set(e.form,"memo",t)},expression:"form.memo"}})],1)],1)],1)],1),e._v(" "),n("el-row",[n("el-col",{attrs:{span:24}},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tabledata,stripe:"",border:""}},[n("el-table-column",{attrs:{label:e._label("guojima"),align:"center",width:"150"},scopedSlots:e._u([{key:"default",fn:function(e){var t=e.row;return[n("sp-product-tip",{attrs:{product:t.product}})]}}])}),e._v(" "),n("el-table-column",{attrs:{label:e._label("chanpinmingcheng"),align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v("\n                    "+e._s(n.product.getName())+"\n                ")]}}])}),e._v(" "),n("el-table-column",{attrs:{label:e._label("chima"),width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){var t=e.row;return[n("sp-select-text",{attrs:{value:t.sizecontentid,source:"sizecontent"}})]}}])}),e._v(" "),n("el-table-column",{attrs:{label:e._label("diaochucangku"),width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.row;return[n("simple-select",{attrs:{source:"warehouse",disabled:e.form.out_id>0,filterMethod:e.filterMethods[o.index]},on:{change:function(t){return e.onWarehouseChange(t,o)}},model:{value:o.out_id,callback:function(t){e.$set(o,"out_id",t)},expression:"row.out_id"}})]}}])}),e._v(" "),n("el-table-column",{attrs:{label:e._label("shuxing"),width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.row;return[n("simple-select",{attrs:{source:"orderproperty"},model:{value:o.property,callback:function(t){e.$set(o,"property",t)},expression:"row.property"}})]}}])}),e._v(" "),n("el-table-column",{attrs:{label:e._label("canpin"),width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.row;return[n("simple-select",{attrs:{source:"defectivelevel"},model:{value:o.defective_level,callback:function(t){e.$set(o,"defective_level",t)},expression:"row.defective_level"}})]}}])}),e._v(" "),n("el-table-column",{attrs:{label:e._label("kucunshuliang"),width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v("\n                        "+e._s(e.stocks[n.index])+"\n                    ")]}}])}),e._v(" "),n("el-table-column",{attrs:{label:e._label("diaorucangku"),width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.row;return[n("simple-select",{attrs:{source:"warehouse",disabled:e.form.in_id>0},model:{value:o.in_id,callback:function(t){e.$set(o,"in_id",t)},expression:"row.in_id"}})]}}])}),e._v(" "),n("el-table-column",{attrs:{label:e._label("diaoboshuliang"),width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.row;return[n("el-input",{attrs:{size:"mini"},model:{value:o.number,callback:function(t){e.$set(o,"number",t)},expression:"row.number"}})]}}])}),e._v(" "),n("el-table-column",{attrs:{label:e._label("caozuo"),width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("as-button",{attrs:{size:"mini",type:"danger"},on:{click:function(n){return e.deleteRow(t)}}},[e._v(e._s(e._label("shanchu")))])]}}])})],1),e._v(" "),n("sp-productstock-input",{on:{input:e.onSelect}})],1)],1)],1)},r=[],a={render:o,staticRenderFns:r};t.a=a}});
//# sourceMappingURL=19-1016.js.map