webpackJsonp([7],{294:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(329),r=o(372),i=o(0),a=i(n.a,r.a,!1,null,null,null);t.default=a.exports},329:function(e,t,o){"use strict";var n=o(27),r=o.n(n),i=o(9),a=o.n(i),l=o(10),s=o.n(l),c=o(175),u=o.n(c),d=o(7),f=o(370),m=o(35);t.a={name:"sp-requisitioncreate",components:u()({},f.a.name,f.a),data:function(){return{form:{requisitiontype:"",out_id:"",in_id:"",memo:""},index:1,tabledata:[],productstocks:[]}},methods:{onOutChange:function(){var e=this;e.form.out_id>0&&e.tabledata.forEach(function(t){t.out_id=e.form.out_id});var t=e.tabledata.pop();t&&e.tabledata.push(t)},onInChange:function(){var e=this;e.form.in_id>0&&e.tabledata.forEach(function(t){t.in_id=e.form.in_id})},onWarehouseChange:function(e,t){var o=this,n=t.product,r=t.sizecontentid;return s()(a.a.mark(function e(){var t,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=o,e.next=3,m.a.getProductstock({productid:n.id,sizecontentid:r});case 3:i=e.sent;case 4:case"end":return e.stop()}},e,o)}))()},onSelect:function(e){var t=this,o=e.product,n=e.number,r=e.sizecontentid;return s()(a.a.mark(function e(){var i,l;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=t,e.next=3,m.a.getProductstock({productid:o.id,sizecontentid:r});case 3:l=e.sent,l.forEach(function(e){i.productstocks.push(e)}),i.tabledata.push({index:i.index,product:o,number:n,sizecontentid:r,property:1,defective_level:1,stock_number:"",in_id:i.form.in_id,out_id:i.form.out_id}),i.index+=1;case 7:case"end":return e.stop()}},e,t)}))()},saveOrder:function(){var e=this;if(confirm(e._label("order_submit_confirm"))){var t={memo:e.form.memo};t.list=e.tabledata.map(function(e){var t=e.product,o=e.sizecontentid,n=e.out_id,r=e.in_id,i=e.property,a=e.defective_level,l=e.number;return{productid:t.id,sizecontentid:o,out_id:n,in_id:r,property:i,defective_level:a,number:l}}),e._submit("/requisition/save",{params:r()(t)}).then(function(t){Object(d.b)(e.form,{out_id:"",in_id:"",memo:""}),e.tabledata=[],e.productstocks=[]})}},deleteRow:function(e){var t=e.$index;this.tabledata.splice(t,1)}},mounted:function(){var e=this;e._setTitle(e._label("xinjiandiaobodan"))},computed:{stockStat:function(){var e=this,t={};return e.productstocks.forEach(function(e){var o=[e.productid,e.sizecontentid,e.property,e.defective_level,e.warehouseid].join("-");t[o]=e.number-e.reserve_number}),t},stocks:function(){var e=this,t={},o=e.stockStat;return e.tabledata.forEach(function(e){var n=[e.product.id,e.sizecontentid,e.property,e.defective_level,e.out_id].join("-");t[e.index]=o[n]||0}),t},filterMethods:function(){var e=this,t={},o=e.stockStat;return e.tabledata.forEach(function(n){t[n.index]=function(t,r){var i=[n.product.id,n.sizecontentid,n.property,n.defective_level,r.id].join("-");return e.form.out_id==r.id||n.out_id==r.id||o[i]&&o[i]>0}}),t}}}},330:function(e,t,o){"use strict";var n=o(9),r=o.n(n),i=o(10),a=o.n(i),l=o(35),s=o(26),c=o(1);t.a={name:"sp-requisition-out",data:function(){return{form:{wordcode:"",goods_code:"",sizecontentid:"",number:""},index:1,tabledata:[],productstocks:[],options:[],product:""}},methods:{onClick:function(){var e=this;e.product&&e.form.number.match(/^\d+$/)&&""!=e.form.sizecontentid&&(e.$emit("input",{product:e.product,number:e.form.number,sizecontentid:e.form.sizecontentid}),e.product="",e.options=[],Object(c.g)(e.form),e.$refs.wordcode.focus())},searchProduct:function(e,t){var o=this;return a()(r.a.mark(function e(){var n,i;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o,""!=n.form.wordcode){e.next=5;break}t([]),e.next=9;break;case 5:return e.next=7,l.a.getProductList(n.form.wordcode,n.form.goods_code);case 7:i=e.sent,t(i);case 9:case"end":return e.stop()}},e,o)}))()},onSelect:function(e){var t=this;return a()(r.a.mark(function o(){var n,i;return r.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return n=t,o.next=3,s.e.load({data:e,depth:1});case 3:i=o.sent,n.options=[],i.sizecontents.forEach(function(e){n.options.push(e)}),n.product=i;case 7:case"end":return o.stop()}},o,t)}))()}}}},370:function(e,t,o){"use strict";var n=o(330),r=o(371),i=o(0),a=i(n.a,r.a,!1,null,null,null);t.a=a.exports},371:function(e,t,o){"use strict";var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tabledata,stripe:"",border:""}},[o("el-table-column",{attrs:{label:e._label("guojima"),align:"center",width:"150"},scopedSlots:e._u([{key:"default",fn:function(e){var t=e.row;return[o("sp-product-tip",{attrs:{product:t.product}})]}}])}),e._v(" "),o("el-table-column",{attrs:{label:e._label("guojima"),align:"center",width:"150"},scopedSlots:e._u([{key:"default",fn:function(e){var t=e.row;return[o("sp-product-tip",{attrs:{product:t.product}})]}}])}),e._v(" "),o("el-table-column",{attrs:{label:e._label("chanpinmingcheng"),align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.row;return[e._v("\n                        "+e._s(o.product.getName())+"\n                    ")]}}])}),e._v(" "),o("el-table-column",{attrs:{label:e._label("chima"),width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){var t=e.row;return[o("sp-select-text",{attrs:{value:t.sizecontentid,source:"sizecontent"}})]}}])}),e._v(" "),o("el-table-column",{attrs:{label:e._label("diaochucangku"),width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[o("simple-select",{attrs:{source:"warehouse",disabled:e.form.out_id>0,filterMethod:e.filterMethods[n.index]},on:{change:function(t){return e.onWarehouseChange(t,n)}},model:{value:n.out_id,callback:function(t){e.$set(n,"out_id",t)},expression:"row.out_id"}})]}}])}),e._v(" "),o("el-table-column",{attrs:{label:e._label("shuxing"),width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[o("simple-select",{attrs:{source:"orderproperty"},model:{value:n.property,callback:function(t){e.$set(n,"property",t)},expression:"row.property"}})]}}])}),e._v(" "),o("el-table-column",{attrs:{label:e._label("canpin"),width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[o("simple-select",{attrs:{source:"defectivelevel"},model:{value:n.defective_level,callback:function(t){e.$set(n,"defective_level",t)},expression:"row.defective_level"}})]}}])}),e._v(" "),o("el-table-column",{attrs:{label:e._label("kucunshuliang"),width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.row;return[e._v("\n                        "+e._s(e.stocks[o.index])+"\n                    ")]}}])}),e._v(" "),o("el-table-column",{attrs:{label:e._label("diaorucangku"),width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[o("simple-select",{attrs:{source:"warehouse",disabled:e.form.in_id>0},model:{value:n.in_id,callback:function(t){e.$set(n,"in_id",t)},expression:"row.in_id"}})]}}])}),e._v(" "),o("el-table-column",{attrs:{label:e._label("diaoboshuliang"),width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[o("el-input",{attrs:{size:"mini"},model:{value:n.number,callback:function(t){e.$set(n,"number",t)},expression:"row.number"}})]}}])}),e._v(" "),o("el-table-column",{attrs:{label:e._label("caozuo"),width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("as-button",{attrs:{size:"mini",type:"danger"},on:{click:function(o){return e.deleteRow(t)}}},[e._v(e._s(e._label("shanchu")))])]}}])})],1),e._v(" "),o("el-form",{ref:"order-form",staticClass:"order-form",attrs:{model:e.form,inline:!0,size:"mini"},nativeOn:{submit:function(e){e.preventDefault()}}},[o("el-form-item",[o("el-autocomplete",{ref:"wordcode",attrs:{placeholder:e._label("guojima"),"fetch-suggestions":e.searchProduct,"value-key":"wordcode"},on:{select:e.onSelect},model:{value:e.form.wordcode,callback:function(t){e.$set(e.form,"wordcode",t)},expression:"form.wordcode"}})],1),e._v(" "),o("el-form-item",[o("el-input",{attrs:{placeholder:e._label("shangpintiaoma")},on:{change:e.searchProduct},model:{value:e.form.goods_code,callback:function(t){e.$set(e.form,"goods_code",t)},expression:"form.goods_code"}})],1),e._v(" "),o("el-form-item",[o("el-select",{ref:"select",staticStyle:{width:"150"},attrs:{placeholder:e._label("chima")},model:{value:e.form.sizecontentid,callback:function(t){e.$set(e.form,"sizecontentid",t)},expression:"form.sizecontentid"}},e._l(e.options,function(e){return o("el-option",{key:e.id+e.name,attrs:{value:e.id,label:e.name}})}),1)],1),e._v(" "),o("el-form-item",[o("el-input",{attrs:{placeholder:e._label("shuliang")},model:{value:e.form.number,callback:function(t){e.$set(e.form,"number",t)},expression:"form.number"}})],1),e._v(" "),o("el-form-item",[o("el-button",{staticStyle:{margin:"0px"},attrs:{type:"primary","native-type":"submit"},on:{click:e.onClick}},[e._v(e._s(e._label("zengjia")))])],1)],1)],1)},r=[],i={render:n,staticRenderFns:r};t.a=i},372:function(e,t,o){"use strict";var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("el-form",{staticClass:"order-form",staticStyle:{width:"100%"},attrs:{model:e.form,"label-width":"85px",inline:!0,size:"mini"}},[o("el-row",{attrs:{gutter:0}},[o("as-button",{attrs:{type:"primary"},on:{click:e.saveOrder}},[e._v(e._s(e._label("shenqing")))])],1),e._v(" "),o("el-row",{attrs:{gutter:0}},[o("el-col",{staticStyle:{width:"300px"},attrs:{span:6}},[o("el-form-item",{attrs:{label:e._label("diaobofangshi")}},[o("simple-select",{attrs:{source:"requisitiontype"},model:{value:e.form.requisitiontype,callback:function(t){e.$set(e.form,"requisitiontype",t)},expression:"form.requisitiontype"}})],1)],1),e._v(" "),"1"==e.form.requisitiontype?o("el-col",{staticStyle:{width:"300px"},attrs:{span:6}},[o("el-form-item",{attrs:{label:e._label("diaochucangku")}},[o("simple-select",{attrs:{source:"warehouse"},on:{change:e.onOutChange},model:{value:e.form.out_id,callback:function(t){e.$set(e.form,"out_id",t)},expression:"form.out_id"}})],1)],1):e._e(),e._v(" "),"2"==e.form.requisitiontype?o("el-col",{staticStyle:{width:"300px"},attrs:{span:6}},[o("el-form-item",{attrs:{label:e._label("diaorucangku")}},[o("simple-select",{attrs:{source:"warehouse"},on:{change:e.onInChange},model:{value:e.form.in_id,callback:function(t){e.$set(e.form,"in_id",t)},expression:"form.in_id"}})],1)],1):e._e(),e._v(" "),e.form.requisitiontype>0?o("el-col",{staticStyle:{width:"300px"},attrs:{span:6}},[o("el-form-item",{attrs:{label:e._label("beizhu")}},[o("el-input",{model:{value:e.form.memo,callback:function(t){e.$set(e.form,"memo",t)},expression:"form.memo"}})],1)],1):e._e()],1)],1),e._v(" "),"1"==e.form.requisitiontype?o("el-row",[o("el-col",{staticClass:"product",attrs:{span:24}},[o("sp-requisition-out")],1)],1):e._e()],1)},r=[],i={render:n,staticRenderFns:r};t.a=i}});
//# sourceMappingURL=7-1017.js.map