webpackJsonp([11],{311:function(e,t,a){"use strict";function r(e){a(436)}Object.defineProperty(t,"__esModule",{value:!0});var l=a(373),s=a(438),n=a(0),i=r,o=n(l.a,s.a,!1,i,null,null);t.default=o.exports},342:function(e,t,a){"use strict";a.d(t,"a",function(){return s});var r=a(141),l=a.n(r),s=function(e){var t={};return{get:function(a){return t[a]||(t[a]=l.a.cloneDeep(e)),t[a]},result:function(){return t}}}},347:function(e,t,a){"use strict";t.a={inject:["bus"],data:function(){return{mypath:""}},created:function(){var e=this;e.bus.$on("close",function(t){t===e.mypath&&e.$destroy()})},beforeDestroy:function(){this.bus.$off("close")},mounted:function(){this.mypath=this.$route.path}}},373:function(e,t,a){"use strict";var r=a(195),l=a.n(r),s=a(6),n=a.n(s),i=a(24),o=a.n(i),u=a(5),c=a.n(u),d=a(12),f=a.n(d),p=a(2),m=a(54),b=a(14),h=a(38),_=a(347),v=(a(342),function(e){return{loadPrice:function(){var t=this;return f()(c.a.mark(function a(){var r,l,s;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(""!=e.form.priceid){t.next=2;break}return t.abrupt("return");case 2:if(r=e.computeProductPrice,l=[],e.tabledata.forEach(function(t){var a=t.productstock.productid;void 0===r[a]&&(e.productPrices.push({productid:a,priceid:e.form.priceid,price:""}),l.push(a))}),!(l.length>0)){t.next=10;break}return t.next=8,h.a.getPriceByProductIds("",l.join(","));case 8:s=t.sent,s.forEach(function(t){e.productPrices.forEach(function(e){t.productid==e.productid&&t.id==e.priceid&&(e.price=t.price)})});case 10:case"end":return t.stop()}},a,t)}))()}}});t.a={name:"sp-salesupdate",mixins:[_.a],data:function(){return{form:{memberid:"",salesstaff:"",externalno:"",warehouseid:"",salesdate:"",ordercode:"",pickingtype:"",expresspaidtype:"",expressno:"",expressfee:"",address:"",saleportid:"",status:"",priceid:"",makestaff:"",makedate:"",id:""},salesdetail:[],tabledata:[],base:{warehouseid:""},pricename:"",productPrices:[],props:{columns:[{name:"payment_type",label:Object(p.d)("fukuanleixing"),type:"select",source:"paymenttype",width:110},{name:"paymentwayid",label:Object(p.d)("fukuanfangshi"),type:"select",source:"paymentway"},{name:"currency",label:Object(p.d)("bizhong"),type:"select",source:"currency",width:90},{name:"amount",label:Object(p.d)("jine"),width:110},{name:"paymentdate",label:Object(p.d)("fukuanriqi"),type:"date",width:110},{name:"memo",label:Object(p.d)("beizhu"),width:150},{name:"makestaff",label:Object(p.d)("tijiaoren"),type:"select",source:"user",is_edit_hide:!0,width:130},{name:"status",label:Object(p.d)("yiruzhang"),type:"switch",is_edit_hide:!0,width:90}],controller:"salesreceive",auth:"sales-salesreceive",base:{salesid:""},options:{isedit:function(e){return 0==e.status},isdelete:function(e){return 0==e.status}}}}},methods:{onPriceChange:function(e,t){this.pricename=t,v(this).loadPrice()},addReceive:function(){var e=this;e.form.id>0&&(e._showDialog("receive-dialog"),e.props.base.salesid=e.form.id)},onWarehouseChange:function(e){this.base.warehouseid=e},save:function(){var e=this;if(e.confirm()){var t=Object(b.c)({},e.form),a={form:t};a.list=e.tabledata.filter(function(t){var a=e.salesdetail.find(function(e){return e.id==t.id});return a.dealprice!=t.dealprice||a.number!=t.number}).map(function(e){return{id:e.id,dealprice:e.dealprice,number:e.number}}),a.deletelist=e.salesdetail.filter(function(t){return!e.tabledata.find(function(e){return e.id==t.id})}).map(function(e){return e.id}),console.log(o()(a)),e._submit("/sales/save",{params:o()(a)}).then(function(t){e.load()})}},sale:function(){var e=this;e.confirm()&&e._submit("/sales/sale",{id:e.form.id}).then(function(t){e.load()})},cancel:function(){var e=this;e.confirm()&&e._submit("/sales/cancel",{id:e.form.id}).then(function(t){e.load()})},appendRow:function(e){var t=this;return f()(c.a.mark(function a(){var r,l;return c.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return r=t,a.next=3,m.e.load({data:e.productstock,depth:1});case 3:return l=a.sent,e.productstock=l,r.tabledata.push(e),a.abrupt("return",e);case 7:case"end":return a.stop()}},a,t)}))()},load:function(){var e=this;return f()(c.a.mark(function t(){var a,r,l,s,i;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=e,r=a.$route,a._setTitle("loading..."),t.next=5,a._fetch("/sales/loadsale",{id:r.params.id});case 5:if(l=t.sent,a.tabledata=[],Object(b.a)(l.data.form,a.form),!l.data.list){t.next=18;break}return a.salesdetail=l.data.list,s=l.data.list.map(function(e){return a.appendRow(Object(b.c)({},e))}),t.next=13,n.a.all(s);case 13:return i=t.sent,v(a).loadPrice(),t.next=17,a._dataSource("price").getLabel(a.form.priceid);case 17:a.pricename=t.sent;case 18:a._setTitle(a._label("xiaoshoudan")+":"+l.data.form.orderno);case 19:case"end":return t.stop()}},t,e)}))()},deleteRow:function(e,t){var a=this;a.$delete(a.tabledata,e)},getSummary:function(e){var t=e.columns,a=e.data,r=this,l=[];return t.forEach(function(e,t){if(0==t)return void(l[t]=r._label("heji"));3==t?l[t]=r.tabledata.reduce(function(e,t){return e+1*t.number},0):7==t&&(l[t]=r.tabledata.reduce(function(e,t){return e+t.dealprice*t.number},0))}),l[1]=a.length,l}},computed:{computeProductPrice:function(){var e=this,t=l()(null);return e.productPrices.forEach(function(a){a.priceid==e.form.priceid&&(t[a.productid]=a.price)}),t}},mounted:function(){this.load()}}},436:function(e,t,a){var r=a(437);"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);a(75)("e27d555a",r,!0,{})},437:function(e,t,a){t=e.exports=a(74)(!1),t.push([e.i,".number .el-input__inner{padding:0 5px}",""])},438:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{staticClass:"order-form",staticStyle:{width:"100%"},attrs:{model:e.form,"label-width":"85px",inline:!0,size:"mini"}},[a("el-row",{attrs:{gutter:0}},[a("asa-button",{attrs:{enable:e._isAllowed("sales-add")&&"3"!=e.form.status},on:{click:e.save}},[e._v(e._s(e._label("baocun")))]),e._v(" "),a("asa-button",{attrs:{enable:e._isAllowed("sales-add")&&1==e.form.status},on:{click:e.sale}},[e._v(e._s(e._label("xiaoshou")))]),e._v(" "),a("asa-button",{attrs:{enable:e._isAllowed("sales-add")&&"1"==e.form.status},on:{click:e.cancel}},[e._v(e._s(e._label("zuofei")))]),e._v(" "),a("asa-button",{attrs:{enable:e._isAllowed("sales-add")&&e.form.id>0&&3!=e.form.status},on:{click:e.addReceive}},[e._v(e._s(e._label("tianjiashoukuan")))]),e._v(" "),e.form.status>0?a("el-tag",{attrs:{type:"warning"}},[a("sp-select-text",{attrs:{value:e.form.status,source:"salestatus"}})],1):e._e()],1),e._v(" "),a("el-row",{attrs:{gutter:0}},[a("el-col",{staticStyle:{width:"300px"},attrs:{span:4}},[a("el-form-item",{attrs:{label:e._label("xiaoshouduankou")}},[a("simple-select",{ref:"saleportid",attrs:{source:"usersaleport",clearable:!1},model:{value:e.form.saleportid,callback:function(t){e.$set(e.form,"saleportid",t)},expression:"form.saleportid"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("jiage")}},[a("simple-select",{ref:"priceid",attrs:{source:"userprice",disabled:""},on:{change:e.onPriceChange},model:{value:e.form.priceid,callback:function(t){e.$set(e.form,"priceid",t)},expression:"form.priceid"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("xiaoshoucangku")}},[a("simple-select",{attrs:{source:"userwarehouse",disabled:""},on:{change:e.onWarehouseChange},model:{value:e.form.warehouseid,callback:function(t){e.$set(e.form,"warehouseid",t)},expression:"form.warehouseid"}})],1),e._v(" "),e.form.warehouseid>0?a("el-form-item",{attrs:{label:e._label("xiaoshouriqi")}},[a("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd"},model:{value:e.form.salesdate,callback:function(t){e.$set(e.form,"salesdate",t)},expression:"form.salesdate"}})],1):e._e(),e._v(" "),e.form.warehouseid>0?a("el-form-item",{attrs:{label:e._label("huiyuan")}},[a("simple-select",{attrs:{source:"member"},model:{value:e.form.memberid,callback:function(t){e.$set(e.form,"memberid",t)},expression:"form.memberid"}})],1):e._e()],1),e._v(" "),e.form.warehouseid>0?a("el-col",{staticStyle:{width:"300px"},attrs:{span:4}},[a("el-form-item",{attrs:{label:e._label("xiaoshouren")}},[a("simple-select",{attrs:{source:"user"},model:{value:e.form.salesstaff,callback:function(t){e.$set(e.form,"salesstaff",t)},expression:"form.salesstaff"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("waibudingdanhao")}},[a("el-input",{model:{value:e.form.externalno,callback:function(t){e.$set(e.form,"externalno",t)},expression:"form.externalno"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("duizhangdanhao")}},[a("el-input",{model:{value:e.form.ordercode,callback:function(t){e.$set(e.form,"ordercode",t)},expression:"form.ordercode"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("zhidanriqi")}},[a("el-input",{attrs:{value:e.form.makedate,placeholder:e._label("zidonghuoqu"),disabled:""}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("zhidanren")}},[a("sp-display-input",{attrs:{value:e.form.makestaff,source:"user"}})],1)],1):e._e(),e._v(" "),e.form.warehouseid>0?a("el-col",{staticStyle:{width:"300px"},attrs:{span:4}},[a("el-form-item",{attrs:{label:e._label("tihuofangshi")}},[a("simple-select",{attrs:{source:"pickingtype"},model:{value:e.form.pickingtype,callback:function(t){e.$set(e.form,"pickingtype",t)},expression:"form.pickingtype"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("kuaidifukuanfang")}},[a("simple-select",{attrs:{source:"expresspaidtype"},model:{value:e.form.expresspaidtype,callback:function(t){e.$set(e.form,"expresspaidtype",t)},expression:"form.expresspaidtype"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("kuaididanhao")}},[a("el-input",{model:{value:e.form.expressno,callback:function(t){e.$set(e.form,"expressno",t)},expression:"form.expressno"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("kuaidifeiyong")}},[a("el-input",{model:{value:e.form.expressfee,callback:function(t){e.$set(e.form,"expressfee",t)},expression:"form.expressfee"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("shouhuodizhi")}},[a("el-input",{model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}})],1)],1):e._e()],1)],1),e._v(" "),a("el-form",{attrs:{model:e.form,inline:!0,size:"mini"},nativeOn:{submit:function(e){e.preventDefault()}}},[e.form.warehouseid>0?a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tabledata,stripe:"",border:"","show-summary":!0,"summary-method":e.getSummary}},[a("el-table-column",{attrs:{label:e._label("guojima"),align:"left",width:"250"},scopedSlots:e._u([{key:"default",fn:function(e){var t=e.row;return[a("sp-product-tip",{attrs:{product:t.productstock.product}})]}}],null,!1,3240663051)}),e._v(" "),a("el-table-column",{attrs:{label:e._label("chima"),width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){var t=e.row;return[a("sp-select-text",{attrs:{value:t.productstock.sizecontentid,source:"sizecontent"}})]}}],null,!1,35572469)}),e._v(" "),a("el-table-column",{attrs:{label:e._label("shangpintiaoma"),align:"center",width:"150"},scopedSlots:e._u([{key:"default",fn:function(e){var t=e.row;return[a("sp-product-code",{attrs:{productid:t.productstock.productid,sizecontentid:t.productstock.sizecontentid}})]}}],null,!1,3309624028)}),e._v(" "),a("el-table-column",{attrs:{label:e._label("shuliang"),width:"70",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-input",{staticClass:"number",staticStyle:{width:"100%"},attrs:{size:"mini",disabled:"1"!=e.form.status},model:{value:r.number,callback:function(t){e.$set(r,"number",t)},expression:"row.number"}})]}}],null,!1,2585054359)}),e._v(" "),a("el-table-column",{attrs:{label:e._label("chengjiaojia"),width:"90",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-input",{staticClass:"number",staticStyle:{width:"100%"},attrs:{size:"mini"},model:{value:r.dealprice,callback:function(t){e.$set(r,"dealprice",t)},expression:"row.dealprice"}})]}}],null,!1,2269190770)}),e._v(" "),a("el-table-column",{attrs:{label:e._label("kucunshuliang"),width:"90",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(e._s(r.productstock.number))])]}}],null,!1,2900167586)}),e._v(" "),a("el-table-column",{attrs:{label:e.pricename,width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(e._s(e.computeProductPrice[r.productstock.productid]))])]}}],null,!1,735070482)}),e._v(" "),a("el-table-column",{attrs:{label:e._label("zongjia"),width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("span",[e._v(e._s(r.dealprice*r.number))])]}}],null,!1,1480306248)}),e._v(" "),a("el-table-column",{attrs:{label:e._label("shuxing"),width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){var t=e.row;return[a("sp-select-text",{attrs:{value:t.productstock.property,source:"orderproperty"}})]}}],null,!1,435211830)}),e._v(" "),a("el-table-column",{attrs:{label:e._label("canpin"),width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){var t=e.row;return[a("sp-select-text",{attrs:{value:t.productstock.defective_level,source:"defectivelevel"}})]}}],null,!1,1520283719)}),e._v(" "),1==e.form.status?a("el-table-column",{attrs:{label:e._label("caozuo"),width:"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row,l=t.$index;return[r.type?e._e():a("as-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.deleteRow(l,r)}}},[e._v(e._s(e._label("shanchu")))])]}}],null,!1,2119887568)}):e._e()],1):e._e()],1),e._v(" "),a("sp-dialog",{ref:"receive-dialog",staticClass:"product",attrs:{title:e._label("qingxuanze"),width:1250}},[e.form.id>0?a("simple-admin-page",e._b({ref:"receive",attrs:{"hide-create":!0,"hide-form":!0}},"simple-admin-page",e.props,!1)):e._e()],1)],1)},l=[],s={render:r,staticRenderFns:l};t.a=s}});