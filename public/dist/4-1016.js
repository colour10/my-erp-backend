webpackJsonp([4],{284:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(317),s=a(350),o=a(0),i=o(r.a,s.a,!1,null,null,null);t.default=i.exports},311:function(e,t,a){"use strict";t.a={inject:["bus"],data:function(){return{mypath:""}},created:function(){var e=this;e.bus.$on("close",function(t){t===e.mypath&&e.$destroy()})},beforeDestroy:function(){this.bus.$off("close")},mounted:function(){this.mypath=this.$route.path}}},317:function(e,t,a){"use strict";var r,s=a(347),o=a.n(s),i=a(176),n=a.n(i),l=a(6),c=a.n(l),u=a(27),d=a.n(u),f=a(9),p=a.n(f),m=a(10),b=a.n(m),h=a(1),_=a(26),v=a(7),k=a(180),y=(a(5),a(35)),w=a(311),x={columns:[{name:"payment_type",label:Object(h.d)("fukuanleixing"),type:"select",source:"paymenttype",width:110},{name:"currency",label:Object(h.d)("bizhong"),type:"select",source:"currency",width:90},{name:"amount",label:Object(h.d)("jine"),width:110},{name:"paymentdate",label:Object(h.d)("fukuanriqi"),type:"date",width:110},{name:"memo",label:Object(h.d)("beizhu"),width:150},{name:"makestaff",label:Object(h.d)("tijiaoren"),type:"select",source:"user",is_edit_hide:!0,width:130},{name:"status",label:Object(h.d)("yiruzhang"),type:"switch",is_edit_hide:!0,width:90}],controller:"salesreceive",auth:"sales",base:{salesid:""},options:{isedit:function(e){return 0==e.status},isdelete:function(e){return 0==e.status}}},g=function(e){var t={loadPrice:function(){var t=this;return b()(p.a.mark(function a(){var r,s,o;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(""!=e.form.priceid){t.next=2;break}return t.abrupt("return");case 2:if(r=e.computeProductPrice,s=[],e.tabledata.forEach(function(t){var a=t.productstock.productid;void 0===r[a]&&(e.productPrices.push({productid:a,priceid:e.form.priceid,price:""}),s.push(a))}),!(s.length>0)){t.next=10;break}return t.next=8,y.a.getPriceByProductIds("",s.join(","));case 8:o=t.sent,o.forEach(function(t){e.productPrices.forEach(function(e){t.productid==e.productid&&t.id==e.priceid&&(e.price=t.price)})});case 10:case"end":return t.stop()}},a,t)}))()},onSelect:function(a){e.tabledata.find(function(e){return e.productstock.id===a.id})||(e.tabledata.push({productstock:a,number:1,dealprice:"",price:0}),t.loadPrice())}};return t};t.a={name:"sp-salesdetail",mixins:[w.a],components:{search:k.a},props:{visible:{type:Boolean},data:{type:Object}},data:function(){return{form:{memberid:"",salesstaff:"",externalno:"",warehouseid:"",salesdate:"",ordercode:"",pickingtype:"",expresspaidtype:"",expressno:"",expressfee:"",address:"",saleportid:"",status:"0",priceid:"",makestaff:"",makedate:"",id:""},tabledata:[],base:{warehouseid:""},props:x,pricename:"",productPrices:[],isChanged:!1}},methods:(r={onPriceChange:function(e,t){this.pricename=t,g(this).loadPrice()},addReceive:function(){var e=this;e.form.id>0&&(e._showDialog("receive-dialog"),x.base.salesid=e.form.id)},getDealPrice:function(e){return 0==e.is_match?e.dealprice:e.price*e.number*this.form.discount},onWarehouseChange:function(e){this.base.warehouseid=e},showProduct:function(){this.$refs.stocksearch.setVisible(!0)},onSelect:function(e){g(this).onSelect(e)},saveOrder:function(e){var t=this;if(3!=t.form.status){var a=Object(v.b)({},t.form);a.status=e;var r={form:a};r.list=t.tabledata.map(function(e){return{productstockid:e.productstock.id,id:e.id,dealprice:e.dealprice,number:e.number,price:t.computeProductPrice[e.productstock.productid],priceid:t.form.priceid}}),t._log(d()(r)),t._submit("/sales/savesale",{params:d()(r)}).then(function(e){t.load(),t.$emit("change",e.data.form),t._redirect("/sales/"+e.data.form.id)})}},save:function(){var e=this,t=Object(v.b)({},e.form),a={form:t};a.list=e.tabledata.map(function(e){return{id:e.id,dealprice:e.dealprice}}),e._submit("/sales/save",{params:d()(a)}).then(function(t){e.load()})},sale:function(){var e=this;if(!confirm(e._label("querentijiao")))return!1;e._submit("/sales/sale",{id:e.form.id}).then(function(t){e.load(),e.$emit("change",t.data.form)})},cancel:function(){var e=this;if(!confirm(e._label("zuofei_warning")))return!1;e._submit("/sales/cancel",{id:e.form.id}).then(function(t){e.load(),e.$emit("change",t.data.form)})},deleteRow:function(e,t){var a=this;a.$delete(a.tabledata,e)},showAttachment:function(){var e=this;e.form.id>0&&e.form.status},yushou:function(){var e=this;0!=e.form.status&&1!=e.form.status||e.saveOrder(1)},tijiao:function(){var e=this;e.canTijiao&&e.$confirm(e._label("tijiao_warning"),e._label("tip"),{confirmButtonText:e._label("ok"),cancelButtonText:e._label("cancel"),type:"warning"}).then(function(){e.saveOrder(2)})}},n()(r,"deleteRow",function(e,t){var a=this;a.$delete(a.tabledata,e)}),n()(r,"appendRow",function(e){var t=this;return b()(p.a.mark(function a(){var r,s;return p.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return r=t,a.next=3,_.f.load({data:e.productstock,depth:1});case 3:return s=a.sent,e.productstock=s,r.tabledata.push(e),a.abrupt("return",e);case 7:case"end":return a.stop()}},a,t)}))()}),n()(r,"load",function(){var e=this;return b()(p.a.mark(function t(){var a,r,s,o,i,n;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e,r=a.$route,s=void 0,a._setTitle("loading..."),0!=r.params.id){t.next=8;break}a._setTitle(a._label("xinjianxiaoshoudan")),t.next=24;break;case 8:return t.next=10,a._fetch("/sales/loadsale",{id:r.params.id});case 10:if(o=t.sent,a.tabledata=[],Object(v.a)(o.data.form,a.form),!o.data.list){t.next=23;break}return i=o.data.list.map(function(e){return a.appendRow(e)}),t.next=17,c.a.all(i);case 17:return n=t.sent,g(a).loadPrice(),t.next=21,a._dataSource("price").getLabel(a.form.priceid);case 21:a.pricename=t.sent,a.isChanged=!1;case 23:a._setTitle(a._label("xiaoshoudan")+":"+o.data.form.orderno);case 24:case"end":return t.stop()}},t,e)}))()}),r),computed:{canTijiao:function(){var e=this.form;return""!=e.warehouseid&&(0==e.status||1==e.status)&&!this.tabledata.some(function(t){return t.productstock.warehouseid!=e.warehouseid})},computeProductPrice:function(){var e=this,t=o()(null);return e.productPrices.forEach(function(a){a.priceid==e.form.priceid&&(t[a.productid]=a.price)}),t}},mounted:function(){this.load(),console.log("hhhhhhhhhhhhhhhhhh")},watch:{tabledata:{handler:function(e,t){this.isChanged=!0},deep:!0}}}},347:function(e,t,a){e.exports={default:a(348),__esModule:!0}},348:function(e,t,a){a(349);var r=a(2).Object;e.exports=function(e,t){return r.create(e,t)}},349:function(e,t,a){var r=a(11);r(r.S,"Object",{create:a(55)})},350:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{staticClass:"order-form",staticStyle:{width:"100%"},attrs:{model:e.form,"label-width":"85px",inline:!0,size:"mini"}},[a("el-row",{attrs:{gutter:0}},["0"==e.form.status||"1"==e.form.status?a("au-button",{attrs:{auth:"sales",type:"primary"},on:{click:e.yushou}},[e._v(e._s(e._label("yushou")))]):e._e(),e._v(" "),2==e.form.status?a("au-button",{attrs:{auth:"sales",type:"primary"},on:{click:e.save}},[e._v(e._s(e._label("baocun")))]):e._e(),e._v(" "),1==e.form.status?a("au-button",{attrs:{auth:"sales",type:!0===e.isChanged?"info":"primary"},on:{click:function(t){return e.sale()}}},[e._v(e._s(e._label("xiaoshou")))]):e._e(),e._v(" "),"1"==e.form.status?a("au-button",{attrs:{auth:"sales",type:"primary"},on:{click:e.cancel}},[e._v(e._s(e._label("zuofei")))]):e._e(),e._v(" "),e.form.id>0&&3!=e.form.status?a("au-button",{attrs:{auth:"sales",type:e.form.id>0?"primary":"info"},on:{click:e.addReceive}},[e._v(e._s(e._label("tianjiashoukuan")))]):e._e(),e._v(" "),e.form.status>0?a("el-tag",{attrs:{type:"warning"}},[a("sp-select-text",{attrs:{value:e.form.status,source:"salestatus"}})],1):e._e()],1),e._v(" "),a("el-row",{attrs:{gutter:0}},[a("el-col",{staticStyle:{width:"300px"},attrs:{span:4}},[a("el-form-item",{attrs:{label:e._label("xiaoshouduankou")}},[a("simple-select",{ref:"saleportid",attrs:{source:"usersaleport"},model:{value:e.form.saleportid,callback:function(t){e.$set(e.form,"saleportid",t)},expression:"form.saleportid"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("jiage")}},[a("simple-select",{ref:"priceid",attrs:{source:"userprice",disabled:0!=e.form.status},on:{change:e.onPriceChange},model:{value:e.form.priceid,callback:function(t){e.$set(e.form,"priceid",t)},expression:"form.priceid"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("xiaoshoucangku")}},[a("simple-select",{attrs:{source:"userwarehouse",disabled:0!=e.form.status},on:{change:e.onWarehouseChange},model:{value:e.form.warehouseid,callback:function(t){e.$set(e.form,"warehouseid",t)},expression:"form.warehouseid"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("xiaoshouriqi")}},[a("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd"},model:{value:e.form.salesdate,callback:function(t){e.$set(e.form,"salesdate",t)},expression:"form.salesdate"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("huiyuan")}},[a("simple-select",{attrs:{source:"member"},model:{value:e.form.memberid,callback:function(t){e.$set(e.form,"memberid",t)},expression:"form.memberid"}})],1)],1),e._v(" "),a("el-col",{staticStyle:{width:"300px"},attrs:{span:4}},[a("el-form-item",{attrs:{label:e._label("xiaoshouren")}},[a("simple-select",{attrs:{source:"user"},model:{value:e.form.salesstaff,callback:function(t){e.$set(e.form,"salesstaff",t)},expression:"form.salesstaff"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("waitudingdanhao")}},[a("el-input",{model:{value:e.form.externalno,callback:function(t){e.$set(e.form,"externalno",t)},expression:"form.externalno"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("duizhangdanhao")}},[a("el-input",{model:{value:e.form.ordercode,callback:function(t){e.$set(e.form,"ordercode",t)},expression:"form.ordercode"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("zhidanriqi")}},[a("el-input",{attrs:{value:e.form.makedate,placeholder:e._label("zidonghuoqu"),disabled:""}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("zhidanren")}},[a("sp-display-input",{attrs:{value:e.form.makestaff,source:"user"}})],1)],1),e._v(" "),a("el-col",{staticStyle:{width:"300px"},attrs:{span:4}},[a("el-form-item",{attrs:{label:e._label("tihuofangshi")}},[a("simple-select",{attrs:{source:"pickingtype"},model:{value:e.form.pickingtype,callback:function(t){e.$set(e.form,"pickingtype",t)},expression:"form.pickingtype"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("kuaidifukuanfang")}},[a("simple-select",{attrs:{source:"expresspaidtype"},model:{value:e.form.expresspaidtype,callback:function(t){e.$set(e.form,"expresspaidtype",t)},expression:"form.expresspaidtype"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("kuaididanhao")}},[a("el-input",{model:{value:e.form.expressno,callback:function(t){e.$set(e.form,"expressno",t)},expression:"form.expressno"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("kuaidifeiyong")}},[a("el-input",{model:{value:e.form.expressfee,callback:function(t){e.$set(e.form,"expressfee",t)},expression:"form.expressfee"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e._label("shouhuodizhi")}},[a("el-input",{model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}})],1)],1)],1)],1),e._v(" "),0==e.form.status?a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:24}},[a("search",{attrs:{base:e.base},on:{select:e.onSelect}})],1)],1):e._e(),e._v(" "),a("el-row",[a("el-col",{attrs:{span:24}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tabledata,stripe:"",border:""}},[a("el-table-column",{attrs:{label:e._label("guojima"),align:"left",width:"200"},scopedSlots:e._u([{key:"default",fn:function(e){var t=e.row;return[a("sp-product-tip",{attrs:{product:t.productstock.product}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e._label("chima"),width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){var t=e.row;return[a("sp-select-text",{attrs:{value:t.productstock.sizecontentid,source:"sizecontent"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e._label("cangku"),width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v("\n                        "+e._s(a.productstock.warehouse.name)+"\n                    ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e._label("kucunshuliang"),width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v("\n                        "+e._s(a.productstock.number)+"\n                    ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.pricename,width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v("\n                        "+e._s(e.computeProductPrice[a.productstock.productid])+"\n                    ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e._label("zongjia"),width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v("\n                        "+e._s(a.dealprice*a.number)+"\n                    ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e._label("shuliang"),width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-input",{staticStyle:{width:"100%"},attrs:{size:"mini",disabled:e.form.status>=2},model:{value:r.number,callback:function(t){e.$set(r,"number",t)},expression:"row.number"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e._label("chengjiaojia"),width:"130",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("el-input",{staticStyle:{width:"100%"},attrs:{size:"mini"},model:{value:r.dealprice,callback:function(t){e.$set(r,"dealprice",t)},expression:"row.dealprice"}})]}}])}),e._v(" "),0==e.form.status||1==e.form.status?a("el-table-column",{attrs:{label:e._label("caozuo"),width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row,s=t.$index;return[a("as-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.deleteRow(s,r)}}},[e._v(e._s(e._label("shanchu")))])]}}],null,!1,3428101906)}):e._e()],1),e._v(" "),a("sp-productstock-input",{on:{input:e.onSelect}})],1)],1),e._v(" "),a("sp-dialog",{ref:"receive-dialog",staticClass:"product",attrs:{title:e._label("qingxuanze"),width:1050}},[e.form.id>0?a("simple-admin-page",e._b({ref:"receive",attrs:{"hide-create":!0,"hide-form":!0}},"simple-admin-page",e.props,!1)):e._e()],1)],1)},s=[],o={render:r,staticRenderFns:s};t.a=o}});
//# sourceMappingURL=4-1016.js.map